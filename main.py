import argparse
import requests
from bs4 import BeautifulSoup
import json

def search_exploit_by_name(name):
    base_url = "https://www.exploitalert.com/api/search-exploit"
    params = {"name": name}

    try:
        response = requests.get(base_url, params=params)
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"Error occurred: {e}")
        return None

def get_exploit_details(exploit_id):
    base_url = f"https://www.exploitalert.com/view-details.html?id={exploit_id}"

    try:
        response = requests.get(base_url)
        response.raise_for_status()
        return response.text
    except requests.exceptions.RequestException as e:
        print(f"Error occurred: {e}")
        return None

def extract_pre_content(html_content):
    soup = BeautifulSoup(html_content, "html.parser")
    pre_element = soup.find("pre")
    if pre_element:
        return pre_element.get_text()
    else:
        return None

def search_command(args):
    software_name = args.name

    results = search_exploit_by_name(software_name)
    if results:
        results.sort(key=lambda x: x.get('date', ''), reverse=False)
        print(f"Search results for {software_name}:")
        for result in results:
            data = {
                "id": result.get('id', ''),
                "name": result.get('name', ''),
                "date": result.get('date', '')
            }
            print(json.dumps(data, indent=2))
            print("=" * 50)
    else:
        print(f"No results found for {software_name}.")

def get_content_command(args):
    exploit_id = args.id

    exploit_details = get_exploit_details(exploit_id)
    if exploit_details:
        content = extract_pre_content(exploit_details)
        if content:
            print(content)
        else:
            print("No exploit details")
    else:
        print(f"Failed to retrieve details for Exploit ID {exploit_id}.")

def main():
    parser = argparse.ArgumentParser(description="Search for exploits or get exploit content.")
    subparsers = parser.add_subparsers(dest="command")

    search_parser = subparsers.add_parser("search", help="Search for exploits")
    search_parser.add_argument("name", type=str, help="Name of the software to search for exploits")

    get_content_parser = subparsers.add_parser("get", help="Get exploit content")
    get_content_parser.add_argument("id", type=int, help="ID of the exploit to get content")

    args = parser.parse_args()

    if args.command == "search":
        search_command(args)
    elif args.command == "get":
        get_content_command(args)
    else:
        parser.print_help()

if __name__ == "__main__":
    main()

